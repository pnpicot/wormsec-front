<div class="device-list-container">
  <div class="table-wrapper">
    <table class="device-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Status</th>
          <th>Risk</th>
          <th>OS</th>
          <th class="filter-header">
            <!-- ✅ BOUTON FILTER SIMPLIFIÉ -->
            <div class="filter-dropdown-container">
              <button 
                class="btn btn-filter" 
                (click)="toggleFilterDropdown($event)"
                [class.active]="hasActiveFilters()"
                [class.open]="isFilterOpen()"
              >
                <i [class]="isFilterOpen() ? 'fas fa-times' : 'fas fa-filter'"></i>
                @if (hasActiveFilters() && !isFilterOpen()) {
                  <span class="filter-badge">{{ filters().status.length + filters().risk.length + filters().os.length }}</span>
                }
              </button>

              @if (isFilterOpen()) {
                <div 
                  class="filter-dropdown"
                  [style.top.px]="dropdownPosition().top"
                  [style.left.px]="dropdownPosition().left"
                >
                  <!-- ✅ BOUTON EN HAUT À DROITE DU DROPDOWN -->
                  <div class="dropdown-header">
                    <span class="dropdown-title">Filters</span>
                    <button 
                      class="btn-close-dropdown" 
                      (click)="toggleFilterDropdown($event)"
                    >
                      <i class="fas fa-times"></i>
                    </button>
                  </div>

                  <div class="filter-section">
                    <span class="filter-section-title">Status</span>
                    <div class="filter-options">
                      <label class="filter-option">
                        <input 
                          type="checkbox" 
                          [checked]="isStatusFilterActive('online')"
                          (change)="toggleStatusFilter('online')"
                        />
                        <span>Online</span>
                      </label>
                      <label class="filter-option">
                        <input 
                          type="checkbox" 
                          [checked]="isStatusFilterActive('compromised')"
                          (change)="toggleStatusFilter('compromised')"
                        />
                        <span>Compromised</span>
                      </label>
                      <label class="filter-option">
                        <input 
                          type="checkbox" 
                          [checked]="isStatusFilterActive('isolated')"
                          (change)="toggleStatusFilter('isolated')"
                        />
                        <span>Isolated</span>
                      </label>
                    </div>
                  </div>

                  <div class="filter-section">
                    <span class="filter-section-title">Risk Level</span>
                    <div class="filter-options">
                      <label class="filter-option">
                        <input 
                          type="checkbox" 
                          [checked]="isRiskFilterActive('low')"
                          (change)="toggleRiskFilter('low')"
                        />
                        <span>Low</span>
                      </label>
                      <label class="filter-option">
                        <input 
                          type="checkbox" 
                          [checked]="isRiskFilterActive('medium')"
                          (change)="toggleRiskFilter('medium')"
                        />
                        <span>Medium</span>
                      </label>
                      <label class="filter-option">
                        <input 
                          type="checkbox" 
                          [checked]="isRiskFilterActive('high')"
                          (change)="toggleRiskFilter('high')"
                        />
                        <span>High</span>
                      </label>
                    </div>
                  </div>

                  <div class="filter-section">
                    <span class="filter-section-title">Operating System</span>
                    <div class="filter-options">
                      <label class="filter-option">
                        <input 
                          type="checkbox" 
                          [checked]="isOSFilterActive('windows')"
                          (change)="toggleOSFilter('windows')"
                        />
                        <span><i class="fab fa-windows"></i> Windows</span>
                      </label>
                      <label class="filter-option">
                        <input 
                          type="checkbox" 
                          [checked]="isOSFilterActive('apple')"
                          (change)="toggleOSFilter('apple')"
                        />
                        <span><i class="fab fa-apple"></i> macOS</span>
                      </label>
                      <label class="filter-option">
                        <input 
                          type="checkbox" 
                          [checked]="isOSFilterActive('linux')"
                          (change)="toggleOSFilter('linux')"
                        />
                        <span><i class="fab fa-linux"></i> Linux</span>
                      </label>
                      <label class="filter-option">
                        <input 
                          type="checkbox" 
                          [checked]="isOSFilterActive('debian')"
                          (change)="toggleOSFilter('debian')"
                        />
                        <span><i class="fab fa-debian"></i> Debian</span>
                      </label>
                    </div>
                  </div>

                  <div class="filter-actions">
                    <button class="btn btn-secondary btn-sm" (click)="clearFilters()">
                      Clear All
                    </button>
                  </div>
                </div>
              }
            </div>
          </th>
        </tr>
      </thead>
      <tbody>
        @for (device of devices; track device.id) {
          <tr 
            (click)="onDeviceClick(device)"
            [class.selected]="isSelected(device)"
            class="device-row"
          >
            <td>
              <span class="device-name">{{ device.name }}</span>
            </td>
            <td>
              <app-status-indicator [status]="device.status" />
            </td>
            <td>
              <div class="risk-indicator {{ device.risk }}">
                {{ device.risk }}
              </div>
            </td>
            <td>
              <i class="fab fa-{{ device.os }} dim-1 os-icon"></i>
            </td>
            <td></td>
          </tr>
        } @empty {
          <tr>
            <td colspan="5" class="no-results">
              <i class="fas fa-search"></i>
              <span>No devices match the current filters</span>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>